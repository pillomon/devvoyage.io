import { c as createComponent, r as renderTemplate, m as maybeRenderHead, u as unescapeHTML } from './astro/server_CEAtNuIX.mjs';
import 'clsx';

const html = "<h2 id=\"tldr\">TL;DR</h2>\n<p>ë¹„ë‹¨ í”„ë¡ íŠ¸ì—”ë“œ ë¿ë§Œì´ ì•„ë‹ˆë”ë¼ë„ development, staging, live(production) í™˜ê²½ì´ ë‹¬ë¼ ë¬¸ì œë¥¼ ê²ªì—ˆë˜ ê²½í—˜ì€ ê°œë°œìë¼ë©´ í•œ ë²ˆì¯¤ì€ ìˆì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²• ì¤‘ Dockerë¥¼ ì‚¬ìš©í•´ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  Docker ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë‹¤ë¤„ë³´ë ¤ í•©ë‹ˆë‹¤. Vercelì—ì„œ ì œê³µí•˜ëŠ” Next.jsì˜ Dockerfile ìƒ˜í”Œì„ ê°€ì§€ê³  ì„¤ëª…ì„í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<p><a href=\"https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile\" rel=\"nofollow\">Next.js Dockerfile sample by Vercel<span> ğŸ”—</span></a></p>\n<h2 id=\"multi-stageë€\">Multi-stageë€?</h2>\n<p>ì œê³µëœ Dockerfileì€ multi-stageë¡œ êµ¬ì„±ë˜ì–´ìˆìœ¼ë©°, multi-stage buildë¥¼ ì‚¬ìš©í•˜ë©° ì•„ë˜ì™€ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<ul>\n<li>ìµœì¢… ì´ë¯¸ì§€ì— í•„ìš”í•œ íŒŒì¼ë§Œ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹Œë“œ ì¤‘ ìƒì„±ëœ ì„ì‹œ íŒŒì¼ì´ë‚˜ ê°œë°œ ë„êµ¬ëŠ” ìµœì¢… ì´ë¯¸ì§€ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n<li>ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ ê° ë‹¨ê³„ì—ì„œ í•„ìš”í•œ ë„êµ¬ì™€ í™˜ê²½ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹Œë“œ ì†ë„ë¥¼ ìµœì í™”í•˜ê³  ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤.</li>\n<li>ë‹¤ì–‘í•œ ë¹Œë“œ í™˜ê²½ì„ ì†ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ì™€ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ë³„ë„ë¡œ êµ¬ì„±í•˜ê³  ê° í™˜ê²½ì— ë§ëŠ” ìµœì ì˜ ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n<li>DockerëŠ” ê° ë¹Œë“œ ë‹¨ê³„ë§ˆë‹¤ ìºì‹œë¥¼ í™œìš©í•˜ë¯€ë¡œ, ë³€ê²½ë˜ì§€ ì•Šì€ ë‹¨ê³„ëŠ” ë‹¤ì‹œ ë¹Œë“œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹Œë“œ ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n</ul>\n<h2 id=\"base-stage\">Base stage</h2>\n<pre class=\"astro-code astro-code-themes dracula dracula\" style=\"background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>FROM node:18-alpine AS base</span></span>\n<span class=\"line\"><span>RUN corepack enable</span></span>\n<span class=\"line\"><span></span></span></code></pre>\n<p>node:18-alpineëŠ” ê¸°ë³¸ ì´ë¯¸ì§€ë¡œì„œ <a href=\"https://hub.docker.com\" rel=\"nofollow\">Docker Hub<span> ğŸ”—</span></a>ë¥¼ í†µí•´ ë³¸ì¸ì—ê²Œ ë” ì í•©í•œ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ ì´ë¯¸ì§€ëŠ” nodejs 18ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. alpineì€ linuxë¥¼ ê²½ëŸ‰í™”í•˜ì—¬ ë°°í¬í•œ ì´ë¯¸ì§€ë¡œ ë³´ì•ˆì— íŠ¹í™”ë˜ì—ˆê³  ë¶ˆí•„ìš”í•œ packageì™€ daemonì´ ì—†ìœ¼ë©° íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¡œ apkë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  base stageì—ì„œ corepackì„ enable í•˜ë©´ baseë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ stageì—ì„œ pnpmì„ ì‚¬ìš©í• ë•Œë§ˆë‹¤ corepack enable pnpmê³¼ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.</p>\n<h2 id=\"deps-stage\">Deps stage</h2>\n<pre class=\"astro-code astro-code-themes dracula dracula\" style=\"background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span># Install dependencies only when needed</span></span>\n<span class=\"line\"><span>FROM base AS deps</span></span>\n<span class=\"line\"><span># Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.</span></span>\n<span class=\"line\"><span>RUN apk add --no-cache libc6-compat</span></span>\n<span class=\"line\"><span>WORKDIR /app</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span># Install dependencies based on the preferred package manager</span></span>\n<span class=\"line\"><span>COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./</span></span>\n<span class=\"line\"><span>RUN \\</span></span>\n<span class=\"line\"><span>  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \\</span></span>\n<span class=\"line\"><span>  elif [ -f package-lock.json ]; then npm ci; \\</span></span>\n<span class=\"line\"><span>  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm &#x26;&#x26; pnpm i --frozen-lockfile; \\</span></span>\n<span class=\"line\"><span>  else echo \"Lockfile not found.\" &#x26;&#x26; exit 1; \\</span></span>\n<span class=\"line\"><span>  fi</span></span>\n<span class=\"line\"><span></span></span></code></pre>\n<p>deps stageë¡œ base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>\n<p>alpine ì´ë¯¸ì§€ëŠ” musl libc ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” glibcë¡œ ì‘ì„±ë˜ì–´ glibcì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ libc6-compat íŒ¨í‚¤ê¸°ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>\n<p>WORKDIR ëª…ë ¹ì–´ë¡œ /app ë””ë ‰í„°ë¦¬ë¥¼ ì‘ì—… ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•´ ì¤€ ë’¤, í˜„ì¬ í”„ë¡œì íŠ¸ì˜ lock íŒŒì¼ì„ ê°€ì ¸ì™€ ì¢…ì†ëœ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì˜ˆì œ Dockerfileì€ yarn, npm, pnpm 3ê°€ì§€ì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì— ëŒ€í•´ ëª¨ë‘ ì‘ì„±ë˜ì–´ìˆì–´ í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì™€ ê´€ë ¨ì—†ëŠ” ëª…ë ¹ì–´ëŠ” ëœì–´ë‚´ê³  ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤. ì €ëŠ” pnpmì„ ì‚¬ìš©í•˜ì˜€ëŠ”ë° lock fileì´ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šê²Œ â€”frozen-lockfile ì˜µì…˜ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ë˜í•œ ì €ëŠ” sharp(ì´ë¯¸ì§€ ìµœì í™” íŒ¨í‚¤ì§€)ë¥¼ linux í”Œë«í¼ê³¼ í˜¸í™˜ë˜ê²Œ í•´ë‹¹ stageì—ì„œ pnpm addë¥¼ í†µí•´ ì„¤ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<pre class=\"astro-code astro-code-themes dracula dracula\" style=\"background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>RUN \\</span></span>\n<span class=\"line\"><span>  if [ -f pnpm-lock.yaml ]; then pnpm i --frozen-lockfile &#x26;&#x26; pnpm add sharp; \\</span></span>\n<span class=\"line\"><span>  else echo \"Lockfile not found.\" &#x26;&#x26; exit 1; \\</span></span>\n<span class=\"line\"><span>  fi</span></span>\n<span class=\"line\"><span></span></span></code></pre>\n<h2 id=\"builder-stage\">Builder stage</h2>\n<pre class=\"astro-code astro-code-themes dracula dracula\" style=\"background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span># Rebuild the source code only when needed</span></span>\n<span class=\"line\"><span>FROM base AS builder</span></span>\n<span class=\"line\"><span>WORKDIR /app</span></span>\n<span class=\"line\"><span>COPY --from=deps /app/node_modules ./node_modules</span></span>\n<span class=\"line\"><span>COPY . .</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span># Next.js collects completely anonymous telemetry data about general usage.</span></span>\n<span class=\"line\"><span># Learn more here: https://nextjs.org/telemetry</span></span>\n<span class=\"line\"><span># Uncomment the following line in case you want to disable telemetry during the build.</span></span>\n<span class=\"line\"><span># ENV NEXT_TELEMETRY_DISABLED 1</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>RUN \\</span></span>\n<span class=\"line\"><span>  if [ -f yarn.lock ]; then yarn run build; \\</span></span>\n<span class=\"line\"><span>  elif [ -f package-lock.json ]; then npm run build; \\</span></span>\n<span class=\"line\"><span>  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm &#x26;&#x26; pnpm run build; \\</span></span>\n<span class=\"line\"><span>  else echo \"Lockfile not found.\" &#x26;&#x26; exit 1; \\</span></span>\n<span class=\"line\"><span>  fi</span></span>\n<span class=\"line\"><span></span></span></code></pre>\n<p>builder stageë¡œ depsì™€ ë™ì¼í•˜ê²Œ base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>\n<p>WORKDIRì„ /appìœ¼ë¡œ ì§€ì •í•œ í›„ COPY ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ deps stageì—ì„œ ì¢…ì†ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ì˜ ê²°ê³¼ì¸ node_modulesë¥¼ í˜„ì¬ ê²½ë¡œì˜ /node_modules ë‚´ë¶€ë¡œ ë³µì‚¬í•˜ê³  ë°”ë¡œ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ COPYë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  íŒŒì¼ì„ ë³µì‚¬í•©ë‹ˆë‹¤..</p>\n<p>ë‘ë²ˆì§¸ COPYë§Œ ì‚¬ìš©í•´ë„ ë ê²ƒ ê°™ì§€ë§Œ, DockerëŠ” ê° ëª…ë ¹ì–´ë§ˆë‹¤ ë ˆì´ì–´ë¥¼ ìƒì„±í•˜ëŠ”ë° ì´ë•Œ ë ˆì´ì–´ê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´, ìºì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. íš¨ìœ¨ì ì¸ ìºì‹œ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œ ë‘ê°œì˜ ëª…ë ¹ì–´ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>\n<p>COPYë¥¼ ì™„ë£Œí•œ ë’¤ RUN ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ Next.js í”„ë¡œì íŠ¸ buildë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì¢…ì†ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ì™€ ë™ì¼í•˜ê²Œ ë¶ˆí•„ìš”í•œ ëª…ë ¹ì–´ëŠ” ëœì–´ë‚´ê³  ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<h2 id=\"runner-stage\">Runner stage</h2>\n<pre class=\"astro-code astro-code-themes dracula dracula\" style=\"background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span># Production image, copy all the files and run next</span></span>\n<span class=\"line\"><span>FROM base AS runner</span></span>\n<span class=\"line\"><span>WORKDIR /app</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ENV NODE_ENV production</span></span>\n<span class=\"line\"><span># Uncomment the following line in case you want to disable telemetry during runtime.</span></span>\n<span class=\"line\"><span># ENV NEXT_TELEMETRY_DISABLED 1</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>RUN addgroup --system --gid 1001 nodejs</span></span>\n<span class=\"line\"><span>RUN adduser --system --uid 1001 nextjs</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span># Set the correct permission for prerender cache</span></span>\n<span class=\"line\"><span>RUN mkdir .next</span></span>\n<span class=\"line\"><span>RUN chown nextjs:nodejs .next</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span># Automatically leverage output traces to reduce image size</span></span>\n<span class=\"line\"><span># https://nextjs.org/docs/advanced-features/output-file-tracing</span></span>\n<span class=\"line\"><span>COPY --from=builder /app/public ./public</span></span>\n<span class=\"line\"><span>COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./</span></span>\n<span class=\"line\"><span>COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>USER nextjs</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>EXPOSE 3000</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ENV PORT 3000</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span># server.js is created by next build from the standalone output</span></span>\n<span class=\"line\"><span># https://nextjs.org/docs/pages/api-reference/next-config-js/output</span></span>\n<span class=\"line\"><span>CMD HOSTNAME=\"0.0.0.0\" node server.js</span></span>\n<span class=\"line\"><span></span></span></code></pre>\n<p>runner stageëŠ” ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. ê¸°ì¡´ stageì—ì„œ ìƒì„±ëœ ë°ì´í„° ì¤‘ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì—­í• ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nbase ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ê³  /appì„ ì‘ì—… ë””ë ‰í„°ë¦¬ë¡œ ì§€ì •í•©ë‹ˆë‹¤. production ê°’ì„ ê°€ì§„ NODE_ENVë¼ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\nì´í›„ id 1001 nodejsë¼ëŠ” ì‹œìŠ¤í…œ user ê·¸ë£¹ê³¼ nextjsë¼ëŠ” ì‹œìŠ¤í…œ userë¥¼ ìƒì„±í•©ë‹ˆë‹¤. builder stageì—ì„œ public í´ë”ì˜ ìë£Œë„ ë³µì‚¬ë¥¼ í•´ì¤ë‹ˆë‹¤.\nì´í›„ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  .next ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•œ í›„ ë””ë ‰í„°ë¦¬ì˜ ownerë¡œ nextjs userì™€ nodejs userGroupì„ ì§€ì •í•´ì¤ë‹ˆë‹¤.</p>\n<p>ì´ëŸ¬í•œ ê¶Œí•œê³¼ ê´€ë ¨ëœ ì‘ì—…ì€ ì•„ë˜ì™€ ê°™ì€ ì´ì ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<ul>\n<li>íŠ¹ì • íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œí•œí•¨ìœ¼ë¡œì¨ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ê¶Œí•œ ìƒìŠ¹ ê³µê²©ì„ ë°©ì§€í•©ë‹ˆë‹¤.</li>\n<li>UIDì™€ GIDë¥¼ ê³ ì •í•˜ì—¬, ê°œë°œ ë° ë°°í¬ í™˜ê²½ì—ì„œ ê¶Œí•œ ì„¤ì •ì´ ì¼ê´€ë˜ê²Œ ìœ ì§€ë˜ë„ë¡ í•©ë‹ˆë‹¤.</li>\n<li>ì‹œìŠ¤í…œ ì‚¬ìš©ìì™€ ê·¸ë£¹ì„ ë¶„ë¦¬í•˜ì—¬, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ê°€ì§€ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.</li>\n</ul>\n<p>ì´í›„ builder ìŠ¤í…Œì´ì§€ì˜ ë¹Œë“œ artifactë¥¼ í˜„ì¬ ë””ë ‰í„°ë¦¬ë¡œ ë³µì‚¬ í›„ í¬íŠ¸ë¥¼ ì§€ì •í•˜ê³  ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ Docker containerê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Vercelì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ Dockerfileì„ ì˜ë¯¸ë¥¼ í•´ì„í•´ë³´ì•˜ëŠ”ë°, ì´ê¸€ì„ ë³´ê³  ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì €ì˜ ê²½ìš° í˜„ì—…ì—ì„œ ë³„ë„ë¡œ ì„œë²„êµ¬ì„± ë‹´ë‹¹ì´ ì—†ê¸°ì— ì œê°€ ì§ì ‘ Dockerí™˜ê²½ì„ êµ¬ì¶•í•˜ì˜€ìœ¼ë©°, ìœ„ì˜ Dockerfileì„ baseë¡œ sharpë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë¡œì§ ì¶”ê°€ ë˜ëŠ” pm2 ì„¤ì •ì„ í†µí•œ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ ì œê³µ ë“± ì €í¬ í”„ë¡œì íŠ¸ì— ë§ê²Œ ë” ë‚˜ì•„ê°€ ì†Œí”„íŠ¸ì›¨ì–´ ìš´ì˜ì— ë„ì›€ì´ ë˜ëŠ” ë°©í–¥ìœ¼ë¡œ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.!</p>";

				const frontmatter = {"isDraft":false,"title":"[Next.js ë°°í¬í•˜ê¸°] 1. Docker","tags":["Next.js","Deploy","Docker"],"thumbnail":{"src":"https://images.unsplash.com/photo-1711885417401-15c2a5a9722d?q=80&w=3024&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","alt":"ì¸ë„¤ì¼"},"createdDate":"2024-05-20T00:00:00.000Z","topic":"Dockerë¥¼ ì´ìš©í•˜ì—¬ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ê³µìœ í•©ë‹ˆë‹¤.","minutesRead":"10 min read"};
				const file = "/Users/pillsang/Desktop/Pilsang/devvoyage.io/src/content/blog/20240520.md";
				const url = undefined;
				function rawContent() {
					return "\n## TL;DR\n\në¹„ë‹¨ í”„ë¡ íŠ¸ì—”ë“œ ë¿ë§Œì´ ì•„ë‹ˆë”ë¼ë„ development, staging, live(production) í™˜ê²½ì´ ë‹¬ë¼ ë¬¸ì œë¥¼ ê²ªì—ˆë˜ ê²½í—˜ì€ ê°œë°œìë¼ë©´ í•œ ë²ˆì¯¤ì€ ìˆì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²• ì¤‘ Dockerë¥¼ ì‚¬ìš©í•´ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  Docker ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë‹¤ë¤„ë³´ë ¤ í•©ë‹ˆë‹¤. Vercelì—ì„œ ì œê³µí•˜ëŠ” Next.jsì˜ Dockerfile ìƒ˜í”Œì„ ê°€ì§€ê³  ì„¤ëª…ì„í•˜ê² ìŠµë‹ˆë‹¤.\n\n[Next.js Dockerfile sample by Vercel](https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile)\n\n## Multi-stageë€?\n\nì œê³µëœ Dockerfileì€ multi-stageë¡œ êµ¬ì„±ë˜ì–´ìˆìœ¼ë©°, multi-stage buildë¥¼ ì‚¬ìš©í•˜ë©° ì•„ë˜ì™€ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.\n\n- ìµœì¢… ì´ë¯¸ì§€ì— í•„ìš”í•œ íŒŒì¼ë§Œ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹Œë“œ ì¤‘ ìƒì„±ëœ ì„ì‹œ íŒŒì¼ì´ë‚˜ ê°œë°œ ë„êµ¬ëŠ” ìµœì¢… ì´ë¯¸ì§€ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n- ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ ê° ë‹¨ê³„ì—ì„œ í•„ìš”í•œ ë„êµ¬ì™€ í™˜ê²½ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹Œë“œ ì†ë„ë¥¼ ìµœì í™”í•˜ê³  ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤.\n- ë‹¤ì–‘í•œ ë¹Œë“œ í™˜ê²½ì„ ì†ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ì™€ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ë³„ë„ë¡œ êµ¬ì„±í•˜ê³  ê° í™˜ê²½ì— ë§ëŠ” ìµœì ì˜ ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n- DockerëŠ” ê° ë¹Œë“œ ë‹¨ê³„ë§ˆë‹¤ ìºì‹œë¥¼ í™œìš©í•˜ë¯€ë¡œ, ë³€ê²½ë˜ì§€ ì•Šì€ ë‹¨ê³„ëŠ” ë‹¤ì‹œ ë¹Œë“œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹Œë“œ ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n## Base stage\n\n```Dockerfile\nFROM node:18-alpine AS base\nRUN corepack enable\n```\n\nnode:18-alpineëŠ” ê¸°ë³¸ ì´ë¯¸ì§€ë¡œì„œ [Docker Hub](https://hub.docker.com)ë¥¼ í†µí•´ ë³¸ì¸ì—ê²Œ ë” ì í•©í•œ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ ì´ë¯¸ì§€ëŠ” nodejs 18ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. alpineì€ linuxë¥¼ ê²½ëŸ‰í™”í•˜ì—¬ ë°°í¬í•œ ì´ë¯¸ì§€ë¡œ ë³´ì•ˆì— íŠ¹í™”ë˜ì—ˆê³  ë¶ˆí•„ìš”í•œ packageì™€ daemonì´ ì—†ìœ¼ë©° íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¡œ apkë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nê·¸ë¦¬ê³  base stageì—ì„œ corepackì„ enable í•˜ë©´ baseë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ stageì—ì„œ pnpmì„ ì‚¬ìš©í• ë•Œë§ˆë‹¤ corepack enable pnpmê³¼ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.\n\n## Deps stage\n\n```Dockerfile\n# Install dependencies only when needed\nFROM base AS deps\n# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.\nRUN apk add --no-cache libc6-compat\nWORKDIR /app\n\n# Install dependencies based on the preferred package manager\nCOPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./\nRUN \\\n  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \\\n  elif [ -f package-lock.json ]; then npm ci; \\\n  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm && pnpm i --frozen-lockfile; \\\n  else echo \"Lockfile not found.\" && exit 1; \\\n  fi\n```\n\ndeps stageë¡œ base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nalpine ì´ë¯¸ì§€ëŠ” musl libc ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” glibcë¡œ ì‘ì„±ë˜ì–´ glibcì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ libc6-compat íŒ¨í‚¤ê¸°ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.\n\nWORKDIR ëª…ë ¹ì–´ë¡œ /app ë””ë ‰í„°ë¦¬ë¥¼ ì‘ì—… ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•´ ì¤€ ë’¤, í˜„ì¬ í”„ë¡œì íŠ¸ì˜ lock íŒŒì¼ì„ ê°€ì ¸ì™€ ì¢…ì†ëœ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì˜ˆì œ Dockerfileì€ yarn, npm, pnpm 3ê°€ì§€ì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì— ëŒ€í•´ ëª¨ë‘ ì‘ì„±ë˜ì–´ìˆì–´ í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì™€ ê´€ë ¨ì—†ëŠ” ëª…ë ¹ì–´ëŠ” ëœì–´ë‚´ê³  ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤. ì €ëŠ” pnpmì„ ì‚¬ìš©í•˜ì˜€ëŠ”ë° lock fileì´ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šê²Œ --frozen-lockfile ì˜µì…˜ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.\n\në˜í•œ ì €ëŠ” sharp(ì´ë¯¸ì§€ ìµœì í™” íŒ¨í‚¤ì§€)ë¥¼ linux í”Œë«í¼ê³¼ í˜¸í™˜ë˜ê²Œ í•´ë‹¹ stageì—ì„œ pnpm addë¥¼ í†µí•´ ì„¤ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n```Dockerfile\nRUN \\\n  if [ -f pnpm-lock.yaml ]; then pnpm i --frozen-lockfile && pnpm add sharp; \\\n  else echo \"Lockfile not found.\" && exit 1; \\\n  fi\n```\n\n## Builder stage\n\n```Dockerfile\n# Rebuild the source code only when needed\nFROM base AS builder\nWORKDIR /app\nCOPY --from=deps /app/node_modules ./node_modules\nCOPY . .\n\n# Next.js collects completely anonymous telemetry data about general usage.\n# Learn more here: https://nextjs.org/telemetry\n# Uncomment the following line in case you want to disable telemetry during the build.\n# ENV NEXT_TELEMETRY_DISABLED 1\n\nRUN \\\n  if [ -f yarn.lock ]; then yarn run build; \\\n  elif [ -f package-lock.json ]; then npm run build; \\\n  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm && pnpm run build; \\\n  else echo \"Lockfile not found.\" && exit 1; \\\n  fi\n```\n\nbuilder stageë¡œ depsì™€ ë™ì¼í•˜ê²Œ base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nWORKDIRì„ /appìœ¼ë¡œ ì§€ì •í•œ í›„ COPY ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ deps stageì—ì„œ ì¢…ì†ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ì˜ ê²°ê³¼ì¸ node_modulesë¥¼ í˜„ì¬ ê²½ë¡œì˜ /node_modules ë‚´ë¶€ë¡œ ë³µì‚¬í•˜ê³  ë°”ë¡œ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ COPYë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  íŒŒì¼ì„ ë³µì‚¬í•©ë‹ˆë‹¤..\n\në‘ë²ˆì§¸ COPYë§Œ ì‚¬ìš©í•´ë„ ë ê²ƒ ê°™ì§€ë§Œ, DockerëŠ” ê° ëª…ë ¹ì–´ë§ˆë‹¤ ë ˆì´ì–´ë¥¼ ìƒì„±í•˜ëŠ”ë° ì´ë•Œ ë ˆì´ì–´ê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´, ìºì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. íš¨ìœ¨ì ì¸ ìºì‹œ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œ ë‘ê°œì˜ ëª…ë ¹ì–´ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nCOPYë¥¼ ì™„ë£Œí•œ ë’¤ RUN ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ Next.js í”„ë¡œì íŠ¸ buildë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì¢…ì†ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ì™€ ë™ì¼í•˜ê²Œ ë¶ˆí•„ìš”í•œ ëª…ë ¹ì–´ëŠ” ëœì–´ë‚´ê³  ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\n## Runner stage\n\n```Dockerfile\n# Production image, copy all the files and run next\nFROM base AS runner\nWORKDIR /app\n\nENV NODE_ENV production\n# Uncomment the following line in case you want to disable telemetry during runtime.\n# ENV NEXT_TELEMETRY_DISABLED 1\n\nRUN addgroup --system --gid 1001 nodejs\nRUN adduser --system --uid 1001 nextjs\n\n# Set the correct permission for prerender cache\nRUN mkdir .next\nRUN chown nextjs:nodejs .next\n\n# Automatically leverage output traces to reduce image size\n# https://nextjs.org/docs/advanced-features/output-file-tracing\nCOPY --from=builder /app/public ./public\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\n\nUSER nextjs\n\nEXPOSE 3000\n\nENV PORT 3000\n\n# server.js is created by next build from the standalone output\n# https://nextjs.org/docs/pages/api-reference/next-config-js/output\nCMD HOSTNAME=\"0.0.0.0\" node server.js\n```\n\nrunner stageëŠ” ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. ê¸°ì¡´ stageì—ì„œ ìƒì„±ëœ ë°ì´í„° ì¤‘ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì—­í• ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nbase ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ê³  /appì„ ì‘ì—… ë””ë ‰í„°ë¦¬ë¡œ ì§€ì •í•©ë‹ˆë‹¤. production ê°’ì„ ê°€ì§„ NODE_ENVë¼ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\nì´í›„ id 1001 nodejsë¼ëŠ” ì‹œìŠ¤í…œ user ê·¸ë£¹ê³¼ nextjsë¼ëŠ” ì‹œìŠ¤í…œ userë¥¼ ìƒì„±í•©ë‹ˆë‹¤. builder stageì—ì„œ public í´ë”ì˜ ìë£Œë„ ë³µì‚¬ë¥¼ í•´ì¤ë‹ˆë‹¤.\nì´í›„ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  .next ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•œ í›„ ë””ë ‰í„°ë¦¬ì˜ ownerë¡œ nextjs userì™€ nodejs userGroupì„ ì§€ì •í•´ì¤ë‹ˆë‹¤.\n\nì´ëŸ¬í•œ ê¶Œí•œê³¼ ê´€ë ¨ëœ ì‘ì—…ì€ ì•„ë˜ì™€ ê°™ì€ ì´ì ì´ ìˆìŠµë‹ˆë‹¤.\n\n- íŠ¹ì • íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œí•œí•¨ìœ¼ë¡œì¨ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ê¶Œí•œ ìƒìŠ¹ ê³µê²©ì„ ë°©ì§€í•©ë‹ˆë‹¤.\n- UIDì™€ GIDë¥¼ ê³ ì •í•˜ì—¬, ê°œë°œ ë° ë°°í¬ í™˜ê²½ì—ì„œ ê¶Œí•œ ì„¤ì •ì´ ì¼ê´€ë˜ê²Œ ìœ ì§€ë˜ë„ë¡ í•©ë‹ˆë‹¤.\n- ì‹œìŠ¤í…œ ì‚¬ìš©ìì™€ ê·¸ë£¹ì„ ë¶„ë¦¬í•˜ì—¬, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ê°€ì§€ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.\n\nì´í›„ builder ìŠ¤í…Œì´ì§€ì˜ ë¹Œë“œ artifactë¥¼ í˜„ì¬ ë””ë ‰í„°ë¦¬ë¡œ ë³µì‚¬ í›„ í¬íŠ¸ë¥¼ ì§€ì •í•˜ê³  ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ Docker containerê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.\n\n## Conclusion\n\nVercelì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ Dockerfileì„ ì˜ë¯¸ë¥¼ í•´ì„í•´ë³´ì•˜ëŠ”ë°, ì´ê¸€ì„ ë³´ê³  ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì €ì˜ ê²½ìš° í˜„ì—…ì—ì„œ ë³„ë„ë¡œ ì„œë²„êµ¬ì„± ë‹´ë‹¹ì´ ì—†ê¸°ì— ì œê°€ ì§ì ‘ Dockerí™˜ê²½ì„ êµ¬ì¶•í•˜ì˜€ìœ¼ë©°, ìœ„ì˜ Dockerfileì„ baseë¡œ sharpë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë¡œì§ ì¶”ê°€ ë˜ëŠ” pm2 ì„¤ì •ì„ í†µí•œ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ ì œê³µ ë“± ì €í¬ í”„ë¡œì íŠ¸ì— ë§ê²Œ ë” ë‚˜ì•„ê°€ ì†Œí”„íŠ¸ì›¨ì–´ ìš´ì˜ì— ë„ì›€ì´ ë˜ëŠ” ë°©í–¥ìœ¼ë¡œ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.!\n";
				}
				function compiledContent() {
					return html;
				}
				function getHeadings() {
					return [{"depth":2,"slug":"tldr","text":"TL;DR"},{"depth":2,"slug":"multi-stageë€","text":"Multi-stageë€?"},{"depth":2,"slug":"base-stage","text":"Base stage"},{"depth":2,"slug":"deps-stage","text":"Deps stage"},{"depth":2,"slug":"builder-stage","text":"Builder stage"},{"depth":2,"slug":"runner-stage","text":"Runner stage"},{"depth":2,"slug":"conclusion","text":"Conclusion"}];
				}

				const Content = createComponent((result, _props, slots) => {
					const { layout, ...content } = frontmatter;
					content.file = file;
					content.url = url;

					return renderTemplate`${maybeRenderHead()}${unescapeHTML(html)}`;
				});

export { Content, compiledContent, Content as default, file, frontmatter, getHeadings, rawContent, url };
