<!DOCTYPE html><html lang="ko"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.12.2"><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/manifest.json"><meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"><meta name="theme-color" content="#FFFFFF" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#1F2937" media="(prefers-color-scheme: dark)"><link rel="sitemap" href="/sitemap-index.xml"><title>[Next.js ë°°í¬í•˜ê¸°] 1. Docker</title><meta name="description" content="Dockerë¥¼ ì´ìš©í•˜ì—¬ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ê³µìœ í•©ë‹ˆë‹¤."><meta property="og:title" content="[Next.js ë°°í¬í•˜ê¸°] 1. Docker"><meta property="og:description" content="Dockerë¥¼ ì´ìš©í•˜ì—¬ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ê³µìœ í•©ë‹ˆë‹¤."><meta property="og:image" content="/images/og.jpg"><meta name="twitter:title" content="[Next.js ë°°í¬í•˜ê¸°] 1. Docker"><meta name="twitter:description" content="Dockerë¥¼ ì´ìš©í•˜ì—¬ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ê³µìœ í•©ë‹ˆë‹¤."><meta name="twitter:image" content="/images/og.jpg"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/_astro/_slug_.CCZJeZEP.css"><script type="module">window.onscroll=function(){e()};const e=()=>{const t=document.body.scrollTop||document.documentElement.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,c=t/n*100,o=document.getElementById("scroll-indicator");o&&(o.style.width=c+"%")};
</script></head> <body class="flex min-h-screen w-full flex-col dark:bg-gray-800"> <header class="w-full dark:bg-gray-800 bg-white"> <div class="mx-auto flex h-[60px] w-full max-w-[992px] items-center justify-between px-[30px]"> <a href="/"><span class="text-2xl font-bold dark:text-white">de<strong class="text-primary">vv</strong>oyage</span></a> <ul class="flex items-center gap-2"> <li class="flex"> <a href="https://github.com/pillomon" target="_blank" rel="noreferrer noopener" class="flex"> <ion-icon name="logo-github" class="text-[26px] text-secondary medium:text-[30px] dark:text-white"></ion-icon> </a> </li> <li class="flex"> <a href="https://www.linkedin.com/in/pillsang-sung-b4aba417a/" target="_blank" rel="noreferrer noopener" class="flex"> <ion-icon name="logo-linkedin" class="text-[26px] text-[rgb(13_91_186)] medium:text-[30px]"></ion-icon> </a> </li> </ul> </div> <div class="h-[5px] w-full bg-transparent"> <div id="scroll-indicator" class="h-full w-0 bg-primary transition-all"></div> </div> </header>  <main class="max-w-[992px] px-[30px] mx-auto mt-10 w-full flex-1">   <div class="mb-16 flex flex-col gap-6"> <h1 class="text-[40px] font-bold leading-[calc(40px*1.5)] dark:text-white"> [Next.js ë°°í¬í•˜ê¸°] 1. Docker </h1> <p class="flex w-full items-center gap-1"> <ion-icon name="time-outline" class="text-[12px] text-secondary dark:text-white"></ion-icon> <span class="text-sm dark:text-white">10 min read</span> </p> </div> <div class="prose-post">  <h2 id="tldr">TL;DR</h2>
<p>ë¹„ë‹¨ í”„ë¡ íŠ¸ì—”ë“œ ë¿ë§Œì´ ì•„ë‹ˆë”ë¼ë„ development, staging, live(production) í™˜ê²½ì´ ë‹¬ë¼ ë¬¸ì œë¥¼ ê²ªì—ˆë˜ ê²½í—˜ì€ ê°œë°œìë¼ë©´ í•œ ë²ˆì¯¤ì€ ìˆì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²• ì¤‘ Dockerë¥¼ ì‚¬ìš©í•´ Next.js ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  Docker ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë‹¤ë¤„ë³´ë ¤ í•©ë‹ˆë‹¤. Vercelì—ì„œ ì œê³µí•˜ëŠ” Next.jsì˜ Dockerfile ìƒ˜í”Œì„ ê°€ì§€ê³  ì„¤ëª…ì„í•˜ê² ìŠµë‹ˆë‹¤.</p>
<p><a href="https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile" rel="nofollow">Next.js Dockerfile sample by Vercel<span> ğŸ”—</span></a></p>
<h2 id="multi-stageë€">Multi-stageë€?</h2>
<p>ì œê³µëœ Dockerfileì€ multi-stageë¡œ êµ¬ì„±ë˜ì–´ìˆìœ¼ë©°, multi-stage buildë¥¼ ì‚¬ìš©í•˜ë©° ì•„ë˜ì™€ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>ìµœì¢… ì´ë¯¸ì§€ì— í•„ìš”í•œ íŒŒì¼ë§Œ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹Œë“œ ì¤‘ ìƒì„±ëœ ì„ì‹œ íŒŒì¼ì´ë‚˜ ê°œë°œ ë„êµ¬ëŠ” ìµœì¢… ì´ë¯¸ì§€ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li>ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ ê° ë‹¨ê³„ì—ì„œ í•„ìš”í•œ ë„êµ¬ì™€ í™˜ê²½ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹Œë“œ ì†ë„ë¥¼ ìµœì í™”í•˜ê³  ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤.</li>
<li>ë‹¤ì–‘í•œ ë¹Œë“œ í™˜ê²½ì„ ì†ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ì™€ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ë³„ë„ë¡œ êµ¬ì„±í•˜ê³  ê° í™˜ê²½ì— ë§ëŠ” ìµœì ì˜ ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li>DockerëŠ” ê° ë¹Œë“œ ë‹¨ê³„ë§ˆë‹¤ ìºì‹œë¥¼ í™œìš©í•˜ë¯€ë¡œ, ë³€ê²½ë˜ì§€ ì•Šì€ ë‹¨ê³„ëŠ” ë‹¤ì‹œ ë¹Œë“œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹Œë“œ ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<h2 id="base-stage">Base stage</h2>
<pre class="astro-code astro-code-themes dracula dracula" style="background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>FROM node:18-alpine AS base</span></span>
<span class="line"><span>RUN corepack enable</span></span>
<span class="line"><span></span></span></code></pre>
<p>node:18-alpineëŠ” ê¸°ë³¸ ì´ë¯¸ì§€ë¡œì„œ <a href="https://hub.docker.com" rel="nofollow">Docker Hub<span> ğŸ”—</span></a>ë¥¼ í†µí•´ ë³¸ì¸ì—ê²Œ ë” ì í•©í•œ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ ì´ë¯¸ì§€ëŠ” nodejs 18ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. alpineì€ linuxë¥¼ ê²½ëŸ‰í™”í•˜ì—¬ ë°°í¬í•œ ì´ë¯¸ì§€ë¡œ ë³´ì•ˆì— íŠ¹í™”ë˜ì—ˆê³  ë¶ˆí•„ìš”í•œ packageì™€ daemonì´ ì—†ìœ¼ë©° íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¡œ apkë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>ê·¸ë¦¬ê³  base stageì—ì„œ corepackì„ enable í•˜ë©´ baseë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ stageì—ì„œ pnpmì„ ì‚¬ìš©í• ë•Œë§ˆë‹¤ corepack enable pnpmê³¼ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.</p>
<h2 id="deps-stage">Deps stage</h2>
<pre class="astro-code astro-code-themes dracula dracula" style="background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span># Install dependencies only when needed</span></span>
<span class="line"><span>FROM base AS deps</span></span>
<span class="line"><span># Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.</span></span>
<span class="line"><span>RUN apk add --no-cache libc6-compat</span></span>
<span class="line"><span>WORKDIR /app</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Install dependencies based on the preferred package manager</span></span>
<span class="line"><span>COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./</span></span>
<span class="line"><span>RUN \</span></span>
<span class="line"><span>  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \</span></span>
<span class="line"><span>  elif [ -f package-lock.json ]; then npm ci; \</span></span>
<span class="line"><span>  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm &#x26;&#x26; pnpm i --frozen-lockfile; \</span></span>
<span class="line"><span>  else echo "Lockfile not found." &#x26;&#x26; exit 1; \</span></span>
<span class="line"><span>  fi</span></span>
<span class="line"><span></span></span></code></pre>
<p>deps stageë¡œ base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>alpine ì´ë¯¸ì§€ëŠ” musl libc ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” glibcë¡œ ì‘ì„±ë˜ì–´ glibcì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ libc6-compat íŒ¨í‚¤ê¸°ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>
<p>WORKDIR ëª…ë ¹ì–´ë¡œ /app ë””ë ‰í„°ë¦¬ë¥¼ ì‘ì—… ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•´ ì¤€ ë’¤, í˜„ì¬ í”„ë¡œì íŠ¸ì˜ lock íŒŒì¼ì„ ê°€ì ¸ì™€ ì¢…ì†ëœ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì˜ˆì œ Dockerfileì€ yarn, npm, pnpm 3ê°€ì§€ì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì— ëŒ€í•´ ëª¨ë‘ ì‘ì„±ë˜ì–´ìˆì–´ í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì™€ ê´€ë ¨ì—†ëŠ” ëª…ë ¹ì–´ëŠ” ëœì–´ë‚´ê³  ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤. ì €ëŠ” pnpmì„ ì‚¬ìš©í•˜ì˜€ëŠ”ë° lock fileì´ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šê²Œ â€”frozen-lockfile ì˜µì…˜ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</p>
<p>ë˜í•œ ì €ëŠ” sharp(ì´ë¯¸ì§€ ìµœì í™” íŒ¨í‚¤ì§€)ë¥¼ linux í”Œë«í¼ê³¼ í˜¸í™˜ë˜ê²Œ í•´ë‹¹ stageì—ì„œ pnpm addë¥¼ í†µí•´ ì„¤ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<pre class="astro-code astro-code-themes dracula dracula" style="background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>RUN \</span></span>
<span class="line"><span>  if [ -f pnpm-lock.yaml ]; then pnpm i --frozen-lockfile &#x26;&#x26; pnpm add sharp; \</span></span>
<span class="line"><span>  else echo "Lockfile not found." &#x26;&#x26; exit 1; \</span></span>
<span class="line"><span>  fi</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="builder-stage">Builder stage</h2>
<pre class="astro-code astro-code-themes dracula dracula" style="background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span># Rebuild the source code only when needed</span></span>
<span class="line"><span>FROM base AS builder</span></span>
<span class="line"><span>WORKDIR /app</span></span>
<span class="line"><span>COPY --from=deps /app/node_modules ./node_modules</span></span>
<span class="line"><span>COPY . .</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Next.js collects completely anonymous telemetry data about general usage.</span></span>
<span class="line"><span># Learn more here: https://nextjs.org/telemetry</span></span>
<span class="line"><span># Uncomment the following line in case you want to disable telemetry during the build.</span></span>
<span class="line"><span># ENV NEXT_TELEMETRY_DISABLED 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN \</span></span>
<span class="line"><span>  if [ -f yarn.lock ]; then yarn run build; \</span></span>
<span class="line"><span>  elif [ -f package-lock.json ]; then npm run build; \</span></span>
<span class="line"><span>  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm &#x26;&#x26; pnpm run build; \</span></span>
<span class="line"><span>  else echo "Lockfile not found." &#x26;&#x26; exit 1; \</span></span>
<span class="line"><span>  fi</span></span>
<span class="line"><span></span></span></code></pre>
<p>builder stageë¡œ depsì™€ ë™ì¼í•˜ê²Œ base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>WORKDIRì„ /appìœ¼ë¡œ ì§€ì •í•œ í›„ COPY ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ deps stageì—ì„œ ì¢…ì†ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ì˜ ê²°ê³¼ì¸ node_modulesë¥¼ í˜„ì¬ ê²½ë¡œì˜ /node_modules ë‚´ë¶€ë¡œ ë³µì‚¬í•˜ê³  ë°”ë¡œ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ COPYë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  íŒŒì¼ì„ ë³µì‚¬í•©ë‹ˆë‹¤..</p>
<p>ë‘ë²ˆì§¸ COPYë§Œ ì‚¬ìš©í•´ë„ ë ê²ƒ ê°™ì§€ë§Œ, DockerëŠ” ê° ëª…ë ¹ì–´ë§ˆë‹¤ ë ˆì´ì–´ë¥¼ ìƒì„±í•˜ëŠ”ë° ì´ë•Œ ë ˆì´ì–´ê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´, ìºì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. íš¨ìœ¨ì ì¸ ìºì‹œ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œ ë‘ê°œì˜ ëª…ë ¹ì–´ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>COPYë¥¼ ì™„ë£Œí•œ ë’¤ RUN ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ Next.js í”„ë¡œì íŠ¸ buildë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì¢…ì†ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ì™€ ë™ì¼í•˜ê²Œ ë¶ˆí•„ìš”í•œ ëª…ë ¹ì–´ëŠ” ëœì–´ë‚´ê³  ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<h2 id="runner-stage">Runner stage</h2>
<pre class="astro-code astro-code-themes dracula dracula" style="background-color:#282A36;--shiki-dark-bg:#282A36;color:#F8F8F2;--shiki-dark:#F8F8F2; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span># Production image, copy all the files and run next</span></span>
<span class="line"><span>FROM base AS runner</span></span>
<span class="line"><span>WORKDIR /app</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ENV NODE_ENV production</span></span>
<span class="line"><span># Uncomment the following line in case you want to disable telemetry during runtime.</span></span>
<span class="line"><span># ENV NEXT_TELEMETRY_DISABLED 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN addgroup --system --gid 1001 nodejs</span></span>
<span class="line"><span>RUN adduser --system --uid 1001 nextjs</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Set the correct permission for prerender cache</span></span>
<span class="line"><span>RUN mkdir .next</span></span>
<span class="line"><span>RUN chown nextjs:nodejs .next</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Automatically leverage output traces to reduce image size</span></span>
<span class="line"><span># https://nextjs.org/docs/advanced-features/output-file-tracing</span></span>
<span class="line"><span>COPY --from=builder /app/public ./public</span></span>
<span class="line"><span>COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./</span></span>
<span class="line"><span>COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static</span></span>
<span class="line"><span></span></span>
<span class="line"><span>USER nextjs</span></span>
<span class="line"><span></span></span>
<span class="line"><span>EXPOSE 3000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ENV PORT 3000</span></span>
<span class="line"><span></span></span>
<span class="line"><span># server.js is created by next build from the standalone output</span></span>
<span class="line"><span># https://nextjs.org/docs/pages/api-reference/next-config-js/output</span></span>
<span class="line"><span>CMD HOSTNAME="0.0.0.0" node server.js</span></span>
<span class="line"><span></span></span></code></pre>
<p>runner stageëŠ” ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. ê¸°ì¡´ stageì—ì„œ ìƒì„±ëœ ë°ì´í„° ì¤‘ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì—­í• ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.
base ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ê³  /appì„ ì‘ì—… ë””ë ‰í„°ë¦¬ë¡œ ì§€ì •í•©ë‹ˆë‹¤. production ê°’ì„ ê°€ì§„ NODE_ENVë¼ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ì´í›„ id 1001 nodejsë¼ëŠ” ì‹œìŠ¤í…œ user ê·¸ë£¹ê³¼ nextjsë¼ëŠ” ì‹œìŠ¤í…œ userë¥¼ ìƒì„±í•©ë‹ˆë‹¤. builder stageì—ì„œ public í´ë”ì˜ ìë£Œë„ ë³µì‚¬ë¥¼ í•´ì¤ë‹ˆë‹¤.
ì´í›„ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  .next ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•œ í›„ ë””ë ‰í„°ë¦¬ì˜ ownerë¡œ nextjs userì™€ nodejs userGroupì„ ì§€ì •í•´ì¤ë‹ˆë‹¤.</p>
<p>ì´ëŸ¬í•œ ê¶Œí•œê³¼ ê´€ë ¨ëœ ì‘ì—…ì€ ì•„ë˜ì™€ ê°™ì€ ì´ì ì´ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>íŠ¹ì • íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œí•œí•¨ìœ¼ë¡œì¨ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ê¶Œí•œ ìƒìŠ¹ ê³µê²©ì„ ë°©ì§€í•©ë‹ˆë‹¤.</li>
<li>UIDì™€ GIDë¥¼ ê³ ì •í•˜ì—¬, ê°œë°œ ë° ë°°í¬ í™˜ê²½ì—ì„œ ê¶Œí•œ ì„¤ì •ì´ ì¼ê´€ë˜ê²Œ ìœ ì§€ë˜ë„ë¡ í•©ë‹ˆë‹¤.</li>
<li>ì‹œìŠ¤í…œ ì‚¬ìš©ìì™€ ê·¸ë£¹ì„ ë¶„ë¦¬í•˜ì—¬, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ê°€ì§€ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.</li>
</ul>
<p>ì´í›„ builder ìŠ¤í…Œì´ì§€ì˜ ë¹Œë“œ artifactë¥¼ í˜„ì¬ ë””ë ‰í„°ë¦¬ë¡œ ë³µì‚¬ í›„ í¬íŠ¸ë¥¼ ì§€ì •í•˜ê³  ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ Docker containerê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Vercelì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ Dockerfileì„ ì˜ë¯¸ë¥¼ í•´ì„í•´ë³´ì•˜ëŠ”ë°, ì´ê¸€ì„ ë³´ê³  ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì €ì˜ ê²½ìš° í˜„ì—…ì—ì„œ ë³„ë„ë¡œ ì„œë²„êµ¬ì„± ë‹´ë‹¹ì´ ì—†ê¸°ì— ì œê°€ ì§ì ‘ Dockerí™˜ê²½ì„ êµ¬ì¶•í•˜ì˜€ìœ¼ë©°, ìœ„ì˜ Dockerfileì„ baseë¡œ sharpë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë¡œì§ ì¶”ê°€ ë˜ëŠ” pm2 ì„¤ì •ì„ í†µí•œ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ ì œê³µ ë“± ì €í¬ í”„ë¡œì íŠ¸ì— ë§ê²Œ ë” ë‚˜ì•„ê°€ ì†Œí”„íŠ¸ì›¨ì–´ ìš´ì˜ì— ë„ì›€ì´ ë˜ëŠ” ë°©í–¥ìœ¼ë¡œ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.!</p>  </div> <div class="mt-[50px]"> <a href="https://github.com/pillomon/devvoyage.io/tree/main/src/content/blog/20240520.md" target="_blank" rel="noopenner noreferer" class="flex w-fit items-center gap-1 rounded-[6px] border-[1px] border-solid border-[#7a828e] bg-[#272B33] p-[16px] text-lg text-white medium:text-2xl">Edit on Github
<ion-icon name="open-outline" class="text-[16px] text-white medium:text-[20px]"></ion-icon></a> </div>   </main> <footer class="mt-[30px] w-full"> <div class="mx-auto flex w-full max-w-[992px] items-center justify-center p-[30px]"> <span class="text-sm medium:text-lg dark:text-white">&copy; All rights reserved.</span> </div> </footer> <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script> <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script> </body> </html>